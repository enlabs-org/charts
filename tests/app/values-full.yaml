---
# Full test values for app chart demonstrating all features

global:
  imagePullPolicy: Always
  envFromSecret: app-secrets
  useDatabaseCert: true
  databaseCert:
    mountPath: "/etc/ssl/certs"
    secretName: "database-cert"
  restartAfterRedeploy: true
  labels:
    app.example.com/environment: "staging"
    app.example.com/team: "platform"
  affinity:
    podAntiAffinity:
      preferredSpreadBy: ["kubernetes.io/hostname"]

components:
  web:
    enabled: true
    image: "myapp-web:v1.0.0"
    replicas: 3
    containerPort: 80
    labels:
      app.example.com/scaling: "enabled"
      app.example.com/shutdown-outside-hours: "true"
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    livenessProbe:
      enabled: true
      path: "/health"
      initialDelaySeconds: 15
      periodSeconds: 10
    readinessProbe:
      enabled: true
      path: "/ready"
      initialDelaySeconds: 5
      periodSeconds: 5
    env:
      - name: APP_ENV
        value: "production"
    service:
      enabled: true
      type: ClusterIP
      port: 80
    ingress:
      enabled: true
      host: "app.example.com"
      path: "/"
      pathType: Prefix
      tls:
        enabled: true
        issuer: "letsencrypt"
      wwwRedirect: true
      basicAuth:
        enabled: true
        username: admin
        password: secret123
      proxyBodySize: "50m"
      whitelistSourceRange: "10.0.0.0/8,192.168.0.0/16"
      securityPathFilter:
        enabled: true
        blockedPaths:
          - "/.git"
          - "/.env"
          - "/.claude"
          - "/vendor"
          - "/node_modules"
    hpa:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 80
      targetMemoryUtilizationPercentage: 80
      behavior:
        scaleDown:
          stabilizationWindowSeconds: 300
          policies:
            - type: Percent
              value: 10
              periodSeconds: 60
        scaleUp:
          stabilizationWindowSeconds: 0
          policies:
            - type: Percent
              value: 100
              periodSeconds: 15
    pdb:
      enabled: true
      minAvailable: 2
    affinity:
      podAntiAffinity:
        requiredSpreadBy: ["topology.kubernetes.io/zone"]
    initContainers:
      - name: wait-for-db
        image: "busybox:latest"
        command: "until nc -z db 5432; do echo waiting; sleep 2; done"
    additionalContainers:
      - name: nginx-sidecar
        image: "nginx:alpine"
        port: 8080
        resources:
          requests:
            cpu: "50m"
            memory: "64Mi"

  worker:
    enabled: true
    image: "myapp-worker:v1.0.0"
    replicas: 5
    command: "php artisan queue:work --queue=high,default"
    labels:
      app.example.com/scaling: "aggressive"
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "1"
        memory: "1Gi"
    env:
      - name: QUEUE_CONNECTION
        value: "redis"
    pdb:
      enabled: true
      minAvailable: 3
    affinity:
      podAntiAffinity:
        avoidComponents: ["web"]

  scheduler:
    enabled: true
    image: "myapp-worker:v1.0.0"
    replicas: 1
    command: "php artisan schedule:work"

jobs:
  - name: db-migrate
    image: "myapp-web:v1.0.0"
    command: "php artisan migrate --force"
    envFromSecret: app-secrets
    restartPolicy: Never
    backoffLimit: 3
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"

  - name: cache-clear
    image: "myapp-web:v1.0.0"
    command: "php artisan cache:clear && php artisan config:cache"
    restartPolicy: Never

cronJobs:
  - name: cleanup
    schedule: "0 2 * * *"
    image: "myapp-worker:v1.0.0"
    command: "php artisan cleanup:old-records"
    concurrencyPolicy: Forbid
    restartPolicy: OnFailure
    resources:
      requests:
        cpu: "50m"
        memory: "128Mi"

  - name: report
    schedule: "0 8 * * 1"
    image: "myapp-worker:v1.0.0"
    command: "php artisan report:weekly"
    envFromSecret: app-secrets
